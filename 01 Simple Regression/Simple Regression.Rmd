---
title: 'Coursera ML: Regression Quiz'
author: "Varun Boodram"
date: "December 5, 2015"
output:
  html_document:
    theme: cerulean
  pdf_document: default
---

R is not recommended for this course; nevertheless, I keep running into errors importing the necessary python packages. This quiz tests the material of week 1 in the course

```{r}
rm(list = ls())
# data obtention
train_data<-read.csv("./datasets/kc_house_train_data.csv", sep = ",", quote = " ", stringsAsFactors = F)
test_data<- read.csv("./datasets/kc_house_test_data.csv", sep = ",", quote = " ", stringsAsFactors = F)

# We expect 21613 in the total (pre-split) data set

nrow(train_data)+nrow(test_data)
```

In the iPython notebook, I couldn't test for NAs in the data set. I made the assumption that it was a well-structured set, but that was actually not good practise. 

```{r}
sum(complete.cases(test_data))==nrow(test_data)
sum(complete.cases(train_data))==nrow(train_data)
```

From now on we will train the models using train_data. It will be important that we use the same split here to ensure the results are the same.

#### Question: 
*Write a generic function that accepts a column of data (e.g, an SArray) ‘input_feature’ and another column ‘output’ and returns the Simple Linear Regression parameters ‘intercept’ and ‘slope’. Use the closed form solution from lecture to calculate the slope and intercept.*

The slope parameter is computed with 
$$\hat{w}_1= \frac{\Sigma_{i=1}^nx_iy_i-\dfrac{1}{n}\Sigma_{i=1}^n y_i \Sigma_{i=1}^nx_i}{\Sigma_{i=1}^n x_i^2-\dfrac{1}{n}\Sigma_{i=1}^nx_i \Sigma_{i=1}^nx_i}$$

The intercept is computed with 
$$\hat{w}_0=\dfrac{1}{n}\Sigma_{i=1}^ny_i-\dfrac{1}{n}\hat{w}_1\Sigma_{i=1}^nx_i$$

Below, we obtain these values computationally, and then compare the computed slope and intercept to the ones generated by the ```lm()``` function

```{r}
regression <- function(input_feature, output){
        # get the four quantities that we need
        n <- length(input_feature)
        input_feature <- as.numeric(input_feature)
        output <- as.numeric(output)
        sigma_xi <- sum(input_feature)
        sigma_yi <- sum(output)
        sigma_x_squared <- sum(input_feature*input_feature)
        sigma_xy <- sum(input_feature*output)
        slope <- (sigma_xy-((sigma_yi*sigma_xi)/n))/(sigma_x_squared-((sigma_xi*sigma_xi)/n))
        intercept<-(sigma_yi/n)-((slope/n)*sigma_xi)
        c(intercept, slope)
}
```

Comparing the output of this function to the output of ```lm()```:

```{r}
regression(input_feature = train_data$sqft_living, 
           output = train_data$price)
reg_fit <- lm(formula = price~sqft_living, data = train_data)
reg_fit$coefficients
```

We can feel confident about this implementation

#### Question
*Use your function to calculate the estimated slope and intercept on the training data to predict ‘price’ given ‘sqft_living’. Save the value of the slope and intercept for later (you might want to call them e.g. squarfeet_slope, and squarefeet_intercept)*

```{r}
out <-regression(input_feature = train_data$sqft_living, 
                 output = train_data$price)
squarefeet_slope <- out[2]
squarefeet_intercept <- out[1]
c(squarefeet_intercept, squarefeet_slope)
```

#### Question
*Write a function that accepts a column of data ‘input_feature’, the ‘slope’, and the ‘intercept’ you learned, and returns an a column of predictions ‘predicted_output’ for each entry in the input column.  What is the predicted price for a house with 2650 sqft?*

```{r}
reg_prediction <-function(input_feature, 
                          intercept,            
                          slope){
        preds <- squarefeet_intercept + squarefeet_slope*input_feature
        preds
}
reg_prediction(input_feature = 2650, 
               intercept = squarefeet_intercept, 
               slope = squarefeet_slope)
sqft_living_test<-data.frame(sqft_living<-2650)
names(sqft_living_test)<-"sqft_living"
predict(object = reg_fit, newdata = sqft_living_test)
```


#### Question:
* Write a function that accepts column of data: ‘input_feature’, and ‘output’ and the regression parameters ‘slope’ and ‘intercept’ and outputs the Residual Sum of Squares (RSS). Quiz Question: According to this function and the slope and intercept from (4) What is the RSS for the simple linear regression using squarefeet to predict prices on TRAINING data?*

```{r}
compute_RSS<-function(input_feature, 
                      output,
                      intercept, 
                      slope){
        preds <- reg_prediction(input_feature = input_feature, intercept = intercept, slope = slope)
        errors <- output - preds
        RSS <- sum(errors*errors)
        RSS
}

compute_RSS(input_feature = train_data$sqft_living, 
            output = train_data$price, 
            intercept = squarefeet_intercept, 
            squarefeet_slope)
sum(resid(reg_fit) ^ 2)
```

#### Question:
Note that although we estimated the regression slope and intercept in order to predict the output from the input, since this is a simple linear relationship with only two variables we can invert the linear function to estimate the input given the output!

*Write a function that accepts a column of data:*```output``` *and the regression parameters* ```slope``` *and* ```intercept``` *and outputs the column of data:* ```estimated_input```. *Do this by solving the linear* ```function output = intercept + slope*input``` *for the* ```input``` *variable*

*Quiz Question: According to this function and the regression slope and intercept from (3) what is the estimated square-feet for a house costing $800,000?*

```{r}
estimate_inputs <-function(output, slope, intercept){
        output <- as.vector(output)
        c <- rep(intercept, length(output))
        inputs <- (output-c)/slope
        inputs
}
estimate_inputs(output = 800000, 
                slope = squarefeet_slope, 
                intercept = squarefeet_intercept)
reg_prediction(input_feature = estimate_inputs(output = 800000,
                                               slope = squarefeet_slope, 
                                               intercept = squarefeet_intercept), 
               intercept = squarefeet_intercept, 
               slope = squarefeet_slope)
```

#### Question:
* Instead of using ‘sqft_living’ to estimate prices we could use ‘bedrooms’ (a count of the number of bedrooms in the house) to estimate prices. Using your function from (3) calculate the Simple Linear Regression slope and intercept for estimating price based on bedrooms. Save this slope and intercept for later (you might want to call them e.g. bedroom_slope, bedroom_intercept).*

```{r}
out <-regression(input_feature = train_data$sqft_living, 
                 output = train_data$price)
bedroom_slope <- out[2]
bedroom_intercept <- out[1]
rm(out)
```

*Now that we have 2 different models compute the RSS from BOTH models on TEST data. Which model (square feet or bedrooms) has lowest RSS on TEST data? Think about why this might be the case.*

```{r}
sqft_RSS <- compute_RSS(input_feature = test_data$sqft_living, 
            output = test_data$price, 
            intercept = squarefeet_intercept, 
            slope = squarefeet_slope)
bedroom_RSS <- compute_RSS(input_feature = test_data$bedrooms, 
            output = test_data$price, 
            intercept = squarefeet_intercept, 
            slope = squarefeet_slope)
which.min(data.frame(sqft_RSS, bedroom_RSS))
```


